sudo: false
language: python
python:
- '2.7'
- '3.5'
- '3.6'
install:
- pip install -U -r requirements.txt
- pip install -U -r test-requirements.txt
- pip install codacy-coverage
script: py.test -v --cov=swimlane --cov-report=xml
after_script: python-codacy-coverage -r coverage.xml
before_deploy: python offline_installer/build_installer.py
deploy:
- provider: releases
  user: $GITHUB_USER
  password: $GITHUB_PASSWORD
  file_glob: true
  file: dist/*offline-installer*
  skip_cleanup: true
  on:
    tags: true
    repo: swimlane/swimlane-python
- provider: s3
  edge: true
  region: $S3_REGION
  access_key_id: $S3_ACCESS_KEY
  secret_access_key: $S3_SECRET_KEY
  bucket: $S3_BUCKET
  upload_dir: python_driver/${TRAVIS_TAG:1}
  local_dir: dist
  skip_cleanup: true
  on:
    tags: true
    repo: swimlane/swimlane-python
    condition: $TRAVIS_PYTHON_VERSION = '2.7'
- provider: pypi
  user: swimlane
  distributions: sdist bdist_wheel
  password: $PIP_PASSWORD
  on:
    tags: true
    repo: swimlane/swimlane-python
    # Package uploaded is universal for Python 2 and 3, just only push to pip during one version build cycle
    condition: $TRAVIS_PYTHON_VERSION = '2.7'
